pipeline {
    agent {
        label 'master'
    }
    
    environment {
        telegramBotId = "5171552267:AAHxacJ1GOs1cWuG-uk1zlAX2i31sA_veaA"
        telegramChatId = "359042866"
    }
    
    stages {
      stage ('Build') {
      steps {
        echo 'Running build automation'
        sh './gradlew build --no-daemon'
        archiveArtifacts artifacts: 'dist/trainSchedule.zip'
      }
     }
        stage('Init') {
            steps {
                script{
                    telegramtext = "line1%0Aline2%0A${env.BUILD_URL}"
                    telegramrequetsurl = "https://api.telegram.org/bot${telegramBotId}/sendMessage?text=${telegramtext}&chat_id=${telegramChatId}"
                }
            }
        }   
    }
    
    post {
        failure {
            httpRequest ignoreSslErrors: true, responseHandle: 'NONE', url: "${telegramrequetsurl}", wrapAsMultipart: false            
        }
        unstable {
            httpRequest ignoreSslErrors: true, responseHandle: 'NONE', url: "${telegramrequetsurl}", wrapAsMultipart: false
        }
        success {   
            httpRequest ignoreSslErrors: true, responseHandle: 'NONE', url: "${telegramrequetsurl}", wrapAsMultipart: false
        }
    }
}
